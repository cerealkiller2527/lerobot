<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LeRobot Web UI</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background: #0b0d11; color: #e8ebf0; }
      header { padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #1b1f2a; }
      h1 { font-size: 18px; margin: 0; font-weight: 600; }
      .container { padding: 16px; display: grid; grid-template-columns: 2fr 1fr; gap: 16px; }
      .card { background: #10141f; border: 1px solid #1b1f2a; border-radius: 10px; overflow: hidden; }
      .card h2 { font-size: 14px; margin: 0; padding: 12px 14px; border-bottom: 1px solid #1b1f2a; background: #0e1320; }
      .content { padding: 12px 14px; }
      .row { display: flex; flex-wrap: wrap; gap: 8px 12px; align-items: center; margin-bottom: 10px; }
      label { font-size: 12px; color: #aab3c1; }
      input[type="range"] { width: 180px; }
      .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }
      .ok { background: #3ddc97; }
      .bad { background: #e06c75; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 10px; }
      .stream { aspect-ratio: 16/9; width: 100%; background: #0b0d11; object-fit: cover; border-radius: 8px; border: 1px solid #1b1f2a; }
      .kv { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 12px; color: #9aa3b2; }
      button { background: #1d63ff; border: none; color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 600; }
      button:disabled { background: #2a3344; cursor: not-allowed; }
      .small { font-size: 12px; }
    </style>
  </head>
  <body>
    <header>
      <h1><span id="status-dot" class="status-dot bad"></span> LeRobot Web UI</h1>
      <div class="kv"><span id="robot-name">robot: -</span></div>
    </header>

    <div class="container">
      <section class="card">
        <h2>Live Cameras</h2>
        <div class="content">
          <div id="streams" class="grid"></div>
        </div>
      </section>

      <aside class="card">
        <h2>Controls</h2>
        <div class="content" id="controls"></div>
        <div class="content">
          <button id="send-action" disabled>Send Action</button>
        </div>
      </aside>
    </div>

    <script>
      const statusDot = document.getElementById('status-dot');
      const robotName = document.getElementById('robot-name');
      const streams = document.getElementById('streams');
      const controls = document.getElementById('controls');
      const sendBtn = document.getElementById('send-action');

      const actionState = {};

      async function getJSON(url) {
        const r = await fetch(url);
        if (!r.ok) throw new Error(`${r.status}`);
        return await r.json();
      }

      function setStatus(ok, name) {
        statusDot.classList.toggle('ok', ok);
        statusDot.classList.toggle('bad', !ok);
        robotName.textContent = `robot: ${name ?? '-'}`;
        sendBtn.disabled = !ok;
      }

      function createSlider(key) {
        const row = document.createElement('div');
        row.className = 'row';
        const label = document.createElement('label');
        label.textContent = key;
        label.setAttribute('for', `sl-${key}`);
        const slider = document.createElement('input');
        slider.type = 'range';
        slider.min = -1;
        slider.max = 1;
        slider.step = 0.01;
        slider.value = 0;
        slider.id = `sl-${key}`;
        const val = document.createElement('span');
        val.className = 'kv';
        val.textContent = '0.00';
        slider.addEventListener('input', () => {
          const v = Number(slider.value);
          val.textContent = v.toFixed(2);
          actionState[key] = v;
        });
        row.append(label, slider, val);
        return row;
      }

      function addStream(camKey) {
        const img = document.createElement('img');
        img.className = 'stream';
        img.src = `/stream/${encodeURIComponent(camKey)}`;
        img.alt = camKey;
        streams.appendChild(img);
      }

      async function init() {
        try {
          const st = await getJSON('/api/status');
          setStatus(st.connected, st.robot_name);

          const ft = await getJSON('/api/features');
          const actionKeys = Object.keys(ft.action_features || {});
          const cameraKeys = ft.camera_keys || [];

          // Controls
          controls.innerHTML = '';
          actionKeys.forEach(k => controls.appendChild(createSlider(k)));

          // Streams
          streams.innerHTML = '';
          cameraKeys.forEach(addStream);
        } catch (e) {
          setStatus(false, '-');
        }
      }

      sendBtn.addEventListener('click', async () => {
        try {
          const r = await fetch('/api/action', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: actionState }),
          });
          if (!r.ok) throw new Error('failed');
        } catch (_) {}
      });

      init();
      setInterval(init, 5000);
    </script>
  </body>
  </html>






